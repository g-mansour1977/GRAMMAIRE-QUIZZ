<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz Examen ‚Äì Gi.Code Formation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- jsPDF pour PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { background:#f4f6f9; }
.quiz-box { max-width:700px; margin:auto; }
.timer { font-weight:bold; color:#dc3545; }
</style>
</head>

<body>

<div class="container mt-5">
  <div class="card quiz-box shadow">
    <div class="card-body" id="app">

      <!-- LOGIN -->
      <div id="login">
        <h4 class="mb-3">üîê Connexion √âl√®ve</h4>
        <input class="form-control mb-2" id="nom" placeholder="Nom de l'√©l√®ve">
        <input class="form-control mb-3" id="classe" placeholder="Classe / Formation">
        <button class="btn btn-primary w-100" onclick="connexion()">Commencer l'examen</button>
      </div>

      <!-- QUIZ -->
      <div id="quiz" style="display:none;">
        <div class="d-flex justify-content-between mb-2">
          <span id="progression"></span>
          <span class="timer">‚è±Ô∏è <span id="temps"></span></span>
        </div>

        <h5 id="question"></h5>
        <div class="d-grid gap-2 mt-3" id="reponses"></div>
      </div>

      <!-- HISTORIQUE -->
      <div id="historique" class="mt-4"></div>

    </div>
  </div>
</div>

<script>
// ================= CONFIG =================
const LIMITE = 30;
const DUREE_EXAMEN = 15 * 60; // 15 min

// ================= QUESTIONS (30) =================
const questions = [
  { question: "Quelle est la nature du mot '√©cole' ?", choix: ["Verbe","Nom","Adjectif"], bonne:1 },
  { question: "Quel logiciel sert au traitement de texte ?", choix: ["Excel","Word","PowerPoint"], bonne:1 },
  { question: "2 + 3 x 4 = ?", choix: ["20","14","24"], bonne:1 },
  { question: "La capitale de la France ?", choix: ["Lyon","Paris","Marseille"], bonne:1 },
  { question: "HTML signifie ?", choix: ["HyperText Markup Language","HighText Markup Language","Hyper Transfer Markup Language"], bonne:0 },
  { question: "CSS sert √† ?", choix: ["Programmer","Mettre en forme","Stocker donn√©es"], bonne:1 },
  { question: "Quelle est la valeur de Pi ?", choix: ["3.14","2.71","1.62"], bonne:0 },
  { question: "Quel est l'√©l√©ment chimique O ?", choix: ["Oxyg√®ne","Or","Osmium"], bonne:0 },
  { question: "Quelle fonction Excel additionne des cellules ?", choix: ["=SOMME()","=MOYENNE()","=MULT()"], bonne:0 },
  { question: "Quelle touche permet de copier ?", choix: ["Ctrl + C","Ctrl + V","Ctrl + X"], bonne:0 },
  { question: "Le moteur de recherche le plus utilis√© ?", choix: ["Bing","Google","Yahoo"], bonne:1 },
  { question: "Langage c√¥t√© client web ?", choix: ["Python","JavaScript","PHP"], bonne:1 },
  { question: "Pays du Soleil Levant ?", choix: ["Chine","Japon","Cor√©e"], bonne:1 },
  { question: "R√©sultat de 7 x 8 ?", choix: ["54","56","58"], bonne:1 },
  { question: "Pluriel de 'cheval' ?", choix: ["Chevals","Chevaux","Chevales"], bonne:1 },
  { question: "Word permet de :", choix: ["Cr√©er tableaux uniquement","Cr√©er documents","Cr√©er calculs"], bonne:1 },
  { question: "PowerPoint sert √† :", choix: ["Faire des diapos","Bases de donn√©es","Programmer"], bonne:0 },
  { question: "L'eau g√®le √† ?", choix: ["0¬∞C","100¬∞C","-10¬∞C"], bonne:0 },
  { question: "Symbole chimique du fer ?", choix: ["Fe","F","Fr"], bonne:0 },
  { question: "Le verbe 'manger' est √† quel groupe ?", choix: ["1er","2e","3e"], bonne:0 },
  { question: "1 km √©quivaut √† ?", choix: ["100 m","1000 m","10 000 m"], bonne:1 },
  { question: "Plan√®te la plus proche du Soleil ?", choix: ["Mercure","V√©nus","Mars"], bonne:0 },
  { question: "Combien de c√¥t√©s a un hexagone ?", choix: ["5","6","8"], bonne:1 },
  { question: "Couleur du ciel sans nuage ?", choix: ["Bleu","Vert","Rouge"], bonne:0 },
  { question: "Python est un langage :", choix: ["Programmation","Naturel","Musical"], bonne:0 },
  { question: "R√©sultat de 12 √∑ 4 ?", choix: ["2","3","4"], bonne:1 },
  { question: "HTML est utilis√© pour :", choix: ["Programmer","Structurer page web","Envoyer emails"], bonne:1 },
  { question: "CSS signifie ?", choix: ["Cascading Style Sheets","Creative Style Sheets","Colorful Style Sheets"], bonne:0 },
  { question: "Combien de continents ?", choix: ["5","6","7"], bonne:2 },
  { question: "Monnaie officielle du S√©n√©gal ?", choix: ["CFA","Euro","Dollar"], bonne:0 },
  { question: "Le Soleil est une :", choix: ["√âtoile","Plan√®te","Com√®te"], bonne:0 }
];

// ================= VARIABLES =================
let index = 0;
let score = 0;
let timer = DUREE_EXAMEN;
let interval;
let eleve = {};

// ================= CONNEXION =================
function connexion(){
  const nom = document.getElementById("nom").value;
  const classe = document.getElementById("classe").value;
  if(!nom || !classe) return alert("Veuillez remplir tous les champs");

  eleve = { nom, classe, date:new Date().toLocaleDateString() };
  localStorage.setItem("eleve", JSON.stringify(eleve));
  
  document.getElementById("login").style.display="none";
  document.getElementById("quiz").style.display="block";

  demarrerTimer();
  afficherQuestion();
}

// ================= TIMER =================
function demarrerTimer(){
  afficherTemps();
  interval = setInterval(()=>{
    timer--;
    afficherTemps();
    if(timer<=0) finQuiz();
  },1000);
}
function afficherTemps(){
  const min = Math.floor(timer/60);
  const sec = timer%60;
  document.getElementById("temps").innerText=`${min}:${sec.toString().padStart(2,"0")}`;
}

// ================= QUIZ =================
function afficherQuestion(){
  if(index>=LIMITE){
    finQuiz();
    return;
  }
  const q = questions[index];
  document.getElementById("progression").innerText=`Question ${index+1} / ${LIMITE}`;
  document.getElementById("question").innerText=q.question;

  const zone=document.getElementById("reponses");
  zone.innerHTML="";
  q.choix.forEach((c,i)=>{
    const b=document.createElement("button");
    b.className="btn btn-outline-primary";
    b.innerText=c;
    b.onclick=()=>verifier(i);
    zone.appendChild(b);
  });
}
function verifier(rep){
  if(rep===questions[index].bonne) score++;
  index++;
  afficherQuestion();
}

// ================= FIN =================
function finQuiz(){
  clearInterval(interval);
  const note20 = Math.round((score/LIMITE)*20);
  const tempsUtilise = `${Math.floor((DUREE_EXAMEN - timer)/60)} min`;

envoyerVersGoogleSheets(note20, tempsUtilise);


  // Enregistrer historique local
  let hist = JSON.parse(localStorage.getItem("historique")) || [];
  hist.push({ ...eleve, score:note20 });
  localStorage.setItem("historique", JSON.stringify(hist));

  document.getElementById("app").innerHTML=`
    <h3 class="text-success">üìä R√©sultat de l'examen</h3>
    <p><strong>Nom :</strong> ${eleve.nom}</p>
    <p><strong>Classe :</strong> ${eleve.classe}</p>
    <p><strong>Date :</strong> ${eleve.date}</p>
    <hr>
    <p class="fs-4">Score : <strong>${note20} / 20</strong></p>
    <div class="alert alert-info">${note20>=15?"‚úÖ Tr√®s bon niveau":note20>=10?"‚ö†Ô∏è Niveau moyen":"‚ùå Niveau √† renforcer"}</div>
    <button class="btn btn-success me-2" onclick="imprimerPDF()">üñ®Ô∏è Imprimer PDF</button>
    <button class="btn btn-secondary" onclick="location.reload()">üîÑ Recommencer</button>
    <h5 class="mt-4">üìö Historique des scores :</h5>
    <ul id="liste-historique" class="list-group mt-2"></ul>
  `;
  afficherHistorique();
}

// ================= HISTORIQUE =================
function afficherHistorique(){
  const hist = JSON.parse(localStorage.getItem("historique"))||[];
  const ul = document.getElementById("liste-historique");
  if(!ul) return;
  ul.innerHTML="";
  hist.forEach((e,i)=>{
    const li = document.createElement("li");
    li.className="list-group-item";
    li.innerText=`${i+1}. ${e.nom} (${e.classe}) - Score: ${e.score}/20 - ${e.date}`;
    ul.appendChild(li);
  });
}

// ================= PDF =================
function imprimerPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Gi.Code Formation - R√©sultat Quiz", 20, 20);
  doc.setFontSize(12);
  doc.text(`Nom: ${eleve.nom}`, 20, 30);
  doc.text(`Classe: ${eleve.classe}`, 20, 40);
  doc.text(`Date: ${eleve.date}`, 20, 50);
  doc.text(`Score: ${Math.round((score/LIMITE)*20)}/20`, 20, 60);
  doc.save(`Resultat_${eleve.nom}.pdf`);
}

function envoyerVersGoogleSheets(note20, temps) {

  fetch("https://script.google.com/macros/s/AKfycbz8-6FAiWW2IcccqULtSaH8ACChqna3kSIb1T_w4Ge5o-w_wP3_bPj6L-EDy7dP_WpT/exec", {
    method: "POST",
    body: JSON.stringify({
      nom: eleve.nom,
      classe: eleve.classe,
      score: note20,
      temps: temps
    })
  })
  .then(res => res.json())
  .then(data => console.log("Enregistr√© :", data))
  .catch(err => console.error("Erreur :", err));
}

</script>

</body>
</html>
